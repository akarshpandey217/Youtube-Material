/*
 youtube-material 2016-08-02 
*/
youtubeApp.factory("searchService",["$q","$http",function(a,b){var c={};c.searchVideos=function(b){var c=a.defer();return youtubeApi.then(function(){gapi.client.youtube.search.list({channelId:b.channelId,order:b.order,part:"snippet",type:"video",regionCode:country,maxResults:b.maxResults?b.maxResults:12,relatedToVideoId:b.relatedToVideoId,q:b.query,pageToken:b.pageToken}).then(function(a){c.resolve(a.result)})}),c.promise},c.getSearchSuggestion=function(c){var d=a.defer();return b({method:"JSONP",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT","Content-Type":"application/json",Accept:"application/json"},url:"http://suggestqueries.google.com/complete/search?callback=JSON_CALLBACK&ds=yt&client=firefox&hl=en&q="+c}).success(function(a){d.resolve(a)}),d.promise},c.getVideos=function(b){var c=a.defer();return youtubeApi.then(function(){gapi.client.youtube.videos.list({regionCode:country,chart:b.chart,maxResults:b.maxResults,pageToken:b.pageToken,part:b.part,id:b.videoId,videoCategoryId:b.videoCategoryId,fields:b.fields}).then(function(a){try{for(var b=0;b<a.result.items.length;b++)a.result.items[b].contentDetails.duration=moment.duration(a.result.items[b].contentDetails.duration).format("h:m:ss"),a.result.items[b].contentDetails.duration=a.result.items[b].contentDetails.duration.includes(":")?a.result.items[b].contentDetails.duration:"0:"+a.result.items[b].contentDetails.duration,a.result.items[b].statistics.viewCount=parseInt(a.result.items[b].statistics.viewCount).toLocaleString()}catch(a){}c.resolve(a.result)})}),c.promise},c.getVideoDetails=function(b){var c=a.defer();return youtubeApi.then(function(){gapi.client.youtube.videos.list({part:b.part,id:f(b.videos),fields:b.fields}).then(function(a){try{for(var b=0;b<a.result.items.length;b++)a.result.items[b].contentDetails.duration=moment.duration(a.result.items[b].contentDetails.duration).format("h:m:ss"),a.result.items[b].contentDetails.duration=a.result.items[b].contentDetails.duration.includes(":")?a.result.items[b].contentDetails.duration:"0:"+a.result.items[b].contentDetails.duration,a.result.items[b].statistics.viewCount=parseInt(a.result.items[b].statistics.viewCount).toLocaleString()}catch(a){}c.resolve(a.result.items)})}),c.promise},c.getMappedChannels=function(b){var c=a.defer();return youtubeApi.then(function(){gapi.client.youtube.channels.list({part:"snippet",id:e(b.videosToMap),fields:b.fields}).then(function(a){var e=d(b.videosToMap,a.result.items);c.resolve(e)})}),c.promise},c.getChannel=function(b){var c=a.defer();return youtubeApi.then(function(){gapi.client.youtube.channels.list({part:b.part,id:b.channelId,fields:b.fields}).then(function(a){c.resolve(a.result.items[0])})}),c.promise},c.getVideoCategories=function(){var b=a.defer();return youtubeApi.then(function(){gapi.client.youtube.videoCategories.list({part:"snippet",regionCode:country}).then(function(a){b.resolve(a.result.items)})}),b.promise},c.getChannels=function(b){var c=a.defer();return youtubeApi.then(function(){gapi.client.youtube.channels.list({part:b.part,id:b.channelIds,fields:b.fields}).then(function(a){c.resolve(a.result.items)})}),c.promise},c.getComments=function(b){var c=a.defer();return youtubeApi.then(function(){gapi.client.youtube.commentThreads.list({part:"snippet,replies",videoId:b.videoId,pageToken:b.pageToken,maxResults:8,order:b.order,fields:"items(id,replies(comments(id,snippet(authorChannelUrl,authorDisplayName,authorGoogleplusProfileUrl,authorProfileImageUrl,canRate,likeCount,publishedAt,textDisplay,updatedAt))),snippet(canReply,topLevelComment(snippet(authorChannelUrl,authorDisplayName,authorGoogleplusProfileUrl,authorProfileImageUrl,canRate,likeCount,publishedAt,textDisplay,updatedAt)),totalReplyCount)),nextPageToken"}).then(function(a){c.resolve(a.result)},function(a){c.reject(a.result)})}),c.promise},c.getSubscriptions=function(b){var c=a.defer();return youtubeApi.then(function(){gapi.client.youtube.subscriptions.list({part:b.part,channelId:b.channelId,maxResults:b.maxResults,order:b.order,fields:b.fields}).then(function(a){c.resolve(a.result)},function(a){c.reject(a.result)})}),c.promise};var d=function(a,b){for(var c=[],d=0;d<a.length;d++)for(var e=0;e<b.length;e++)if(b[e].id==a[d].snippet.channelId){c[d]={},c[d].channelThumbnail=b[e].snippet.thumbnails.default.url;break}return c},e=function(a){for(var b="",c=a.length-1;c>=0;c--)b+=a[c].snippet.channelId+",";return b},f=function(a){for(var b="",c=0;c<a.length;c++)b+=a[c].id.videoId+",";return b};return c}]);